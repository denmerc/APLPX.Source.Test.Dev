<controls:MetroWindow x:Class="APLPX.UI.WPF.MainWindow"
                      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                      xmlns:controls="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
                      xmlns:converters="clr-namespace:APLPX.UI.WPF.Converters"
                      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                      xmlns:local="clr-namespace:APLPX.UI.WPF"
                      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                      xmlns:scm="clr-namespace:System.ComponentModel;assembly=WindowsBase"
                      xmlns:vm="clr-namespace:APLPX.UI.WPF.ViewModels"
                      Title="PRICEXPERT"
                      Height="900"
                      MinWidth="1080"
                      MinHeight="530"
                      BorderThickness="1"
                      GlowBrush="{DynamicResource ApplicationGlowBrushBorderColor}"
                      NonActiveWindowTitleBrush="{DynamicResource ApplicationTitleBarColorInactive}"
                      ShowIconOnTitleBar="True"
                      WindowStartupLocation="CenterScreen"
                      WindowState="Maximized"
                      WindowTitleBrush="{DynamicResource ApplicationTitleBarColor}"
                      d:DesignHeight="1354"
                      mc:Ignorable="d">

    <controls:MetroWindow.Resources>
        <ResourceDictionary>

            <converters:InverseBooleanConverter x:Key="InverseBooleanConverter" />

            <CollectionViewSource x:Key="cvsModules" Source="{Binding Path=SelectableModules}">
                <CollectionViewSource.SortDescriptions>
                    <scm:SortDescription Direction="Ascending" PropertyName="Sort" />
                </CollectionViewSource.SortDescriptions>
            </CollectionViewSource>

            <CollectionViewSource x:Key="cvsFeatures" Source="{Binding Path=SelectedModule.Features}">
                <CollectionViewSource.SortDescriptions>
                    <scm:SortDescription Direction="Ascending" PropertyName="Sort" />
                </CollectionViewSource.SortDescriptions>
            </CollectionViewSource>



            <DataTemplate x:Key="moduleItemTemplate">
                <StackPanel Height="65"
                            VerticalAlignment="Center"
                            Orientation="Horizontal">
                    <Canvas x:Name="itemCanvas" Style="{StaticResource moduleCanvasStyle}">
                        <Path x:Name="itemPath"
                              Data="F1 M 18.0025,57.0081L 18.0025,23.0032L 23.0032,23.0032L 23.0032,20.0028C 23.0033,18.898 23.8988,18.0025 25.0035,18.0025L 29.004,18.0025C 30.1087,18.0025 31.0042,18.898 31.0043,20.0026L 31.0043,23.0032L 45.0063,23.0032L 45.0062,20.0026C 45.0062,18.8978 45.9018,18.0023 47.0065,18.0023L 51.0071,18.0023C 52.1118,18.0023 53.0074,18.8978 53.0074,20.0026L 53.0074,23.0032L 58.0081,23.0032L 58.0081,57.0081L 18.0025,57.0081 Z M 21.0029,54.0077L 55.0076,54.0077L 55.0076,31.0044L 21.0029,31.0044L 21.0029,54.0077 Z M 23.0032,47.0066L 29.004,47.0066L 29.004,52.0073L 23.0032,52.0073L 23.0032,47.0066 Z M 31.0043,47.0066L 37.0051,47.0066L 37.0051,52.0073L 31.0043,52.0073L 31.0043,47.0066 Z M 39.0054,47.0066L 45.0063,47.0066L 45.0063,52.0073L 39.0054,52.0073L 39.0054,47.0066 Z M 47.0065,47.0066L 53.0074,47.0066L 53.0074,52.0073L 47.0065,52.0073L 47.0065,47.0066 Z M 23.0032,40.0056L 29.004,40.0056L 29.004,45.0063L 23.0032,45.0063L 23.0032,40.0056 Z M 31.0043,40.0056L 37.0051,40.0056L 37.0051,45.0063L 31.0043,45.0063L 31.0043,40.0056 Z M 39.0054,40.0056L 45.0063,40.0056L 45.0063,45.0063L 39.0054,45.0063L 39.0054,40.0056 Z M 47.0065,40.0056L 53.0074,40.0056L 53.0074,45.0063L 47.0065,45.0063L 47.0065,40.0056 Z M 31.0043,33.0048L 37.0051,33.0048L 37.0051,38.0055L 31.0043,38.0055L 31.0043,33.0048 Z M 39.0054,33.0048L 45.0063,33.0048L 45.0063,38.0055L 39.0054,38.0055L 39.0054,33.0048 Z M 47.0065,33.0048L 53.0074,33.0048L 53.0074,38.0055L 47.0065,38.0055L 47.0065,33.0048 Z M 48.5067,20.0028C 47.6782,20.0028 47.0065,20.6745 47.0065,21.5031L 47.0065,24.5035C 47.0065,25.332 47.6782,26.0037 48.5067,26.0037L 49.5069,26.0037C 50.3354,26.0037 51.0071,25.332 51.0071,24.5035L 51.0071,21.5031C 51.0071,20.6745 50.3354,20.0028 49.5069,20.0028L 48.5067,20.0028 Z M 26.5037,20.0028C 25.6751,20.0028 25.0035,20.6745 25.0035,21.503L 25.0035,24.5034C 25.0035,25.332 25.6751,26.0037 26.5037,26.0037L 27.5038,26.0037C 28.3324,26.0037 29.004,25.332 29.004,24.5034L 29.004,21.503C 29.004,20.6745 28.3324,20.0028 27.5038,20.0028L 26.5037,20.0028 Z "
                              Style="{StaticResource moduleGraphicsPathStyle}" />
                    </Canvas>
                    <TextBlock x:Name="txtTitle"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               FontSize="24"
                               FontWeight="Bold"
                               Foreground="White"
                               Text="{Binding Path=Name}"
                               ToolTip="{Binding Path=Title}" />
                </StackPanel>
                <DataTemplate.Triggers>
                    <DataTrigger Binding="{Binding Path=TypeId}" Value="Planning">
                        <Setter TargetName="itemPath" Property="Data" Value="F1 M 22,52L 22,35L 30,35L 30,52L 22,52 Z M 32,52L 32,22L 39,22L 39,52L 32,52 Z M 41,52L 41,41L 49,41L 49,52L 41,52 Z M 51,52L 51,29L 59,29L 59,52L 51,52 Z M 17,19L 20,19L 20,54L 59,54L 59,57L 17,57L 17,19 Z " />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Path=TypeId}" Value="Tracking">
                        <Setter TargetName="itemPath" Property="Data" Value="F1 M 15.8332,47.5002L 15.8332,40.1901L 25.3332,31.6669L 30.0832,36.4169L 34.8331,20.5836L 44.3331,31.6669L 50.6664,25.3336L 45.9164,20.5836L 58.583,20.5836L 58.583,33.2502L 53.8331,28.5003L 44.3331,38.0002L 36.4165,28.5003L 31.6665,44.3335L 25.3332,38.0002L 15.8332,47.5002 Z " />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Path=TypeId}" Value="Reporting">
                        <Setter TargetName="itemPath" Property="Data" Value="F1 M 25,27L 46,19L 46,22.25L 28.5,29L 31.75,31.25L 51,23.75L 51,48.5L 31.75,57L 25,52L 25,27 Z " />
                    </DataTrigger>
                    <!--  TODO: add ModuleType enum value for Administration:  -->
                    <DataTrigger Binding="{Binding Path=Name}" Value="Administration">
                        <Setter TargetName="itemPath" Property="Data" Value="F1 M 23,19L 53,19L 56.9999,25.0001L 57,27L 19,27L 19,25.0001L 23,19 Z M 19,42L 19,29.0001L 56.9999,29.0001L 57,42L 54.038,42L 52.7168,35.7843L 23.4742,42L 19,42 Z M 34,33L 34,35L 42,35L 42,33L 34,33 Z M 19,57L 19,44L 56.9999,44L 57,57L 19,57 Z M 34,48L 34,50L 42,50L 42,48L 34,48 Z " />
                    </DataTrigger>
                </DataTemplate.Triggers>
            </DataTemplate>

            <DataTemplate x:Key="featureItemTemplate">
                <StackPanel Width="115" VerticalAlignment="Center">
                    <Canvas x:Name="itemCanvas" Style="{StaticResource featureCanvasStyle}">
                        <Path x:Name="itemPath"
                              Data="F1 M 22,52L 22,35L 30,35L 30,52L 22,52 Z M 32,52L 32,22L 39,22L 39,52L 32,52 Z M 41,52L 41,41L 49,41L 49,52L 41,52 Z M 51,52L 51,29L 59,29L 59,52L 51,52 Z M 17,19L 20,19L 20,54L 59,54L 59,57L 17,57L 17,19 Z "
                              Style="{StaticResource featureGraphicsPathStyle}" />
                    </Canvas>
                    <TextBlock HorizontalAlignment="Center"
                               FontSize="14"
                               Foreground="{StaticResource Foreground}"
                               Text="{Binding Path=Name}"
                               ToolTip="{Binding Path=Title}" />
                </StackPanel>
                <DataTemplate.Triggers>
                    <DataTrigger Binding="{Binding Path=TypeId}" Value="PlanningAnalytics">
                        <Setter TargetName="itemPath" Property="Data" Value="F1 M 22,52L 22,35L 30,35L 30,52L 22,52 Z M 32,52L 32,22L 39,22L 39,52L 32,52 Z M 41,52L 41,41L 49,41L 49,52L 41,52 Z M 51,52L 51,29L 59,29L 59,52L 51,52 Z M 17,19L 20,19L 20,54L 59,54L 59,57L 17,57L 17,19 Z " />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Path=TypeId}" Value="PlanningEverydayPricing">
                        <Setter TargetName="itemPath" Property="Data" Value="F1 M 19,19L 20.1875,19L 20.1875,57L 19,57L 19,19 Z M 22.1666,19L 23.75,19L 23.75,57L 22.1666,57L 22.1666,19 Z M 25.3333,19L 28.5,19L 28.5,57L 25.3333,57L 25.3333,19 Z M 30.0833,19L 31.6666,19L 31.6666,57L 30.0833,57L 30.0833,19 Z M 33.25,19L 34.0416,19L 34.0416,57L 33.25,57L 33.25,19 Z M 38,19L 42.75,19L 42.75,57L 38,57L 38,19 Z M 44.3333,19L 45.9166,19L 45.9166,57L 44.3333,57L 44.3333,19 Z M 50.6667,19L 53.8333,19L 53.8333,57L 50.6667,57L 50.6667,19 Z M 55.4167,19L 57,19L 57,57L 55.4167,57L 55.4167,19 Z M 47.5,19L 48.2917,19L 48.2917,57L 47.5,57L 47.5,19 Z " />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Path=TypeId}" Value="PlanningPromotionPricing">
                        <Setter TargetName="itemPath" Property="Data" Value="F1 M 24.5416,19L 33.25,19L 55.4167,41.1667C 56.6533,42.4033 56.6533,44.4083 55.4167,45.645L 45.645,55.4167C 44.4084,56.6533 42.4033,56.6533 41.1667,55.4167L 19,33.25L 19,24.5417C 19,22.6945 19,20.8472 19.9236,19.9236C 20.8472,19 22.6944,19 24.5416,19 Z M 26.9167,23.75C 25.1678,23.75 23.75,25.1678 23.75,26.9167C 23.75,28.6656 25.1678,30.0833 26.9167,30.0833C 28.6656,30.0833 30.0833,28.6656 30.0833,26.9167C 30.0833,25.1678 28.6656,23.75 26.9167,23.75 Z " />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Path=TypeId}" Value="PlanningKitPricing">
                        <Setter TargetName="itemPath" Property="Data" Value="F1 M 18,40L 36,40L 36,58L 18,58L 18,40 Z M 40,58L 40,40L 58,40L 58,58L 40,58 Z M 40,36L 40,18L 58,18L 58,36L 40,36 Z M 29,36L 25,36L 25,29L 18,29L 18,25L 25,25L 25,18L 29,18L 29,25L 36,25L 36,29L 29,29L 29,36 Z " />
                    </DataTrigger>

                    <!--  TODO: add ModuleFeatureType enum values for these features:  -->
                    <DataTrigger Binding="{Binding Path=Name}" Value="Users">
                        <Setter TargetName="itemPath" Property="Data" Value="F1 M 38,26.9167C 42.618,26.9167 44.5972,29.5555 43.9312,35.0945C 44.5262,35.4358 44.9271,36.0773 44.9271,36.8125C 44.9271,37.7121 44.3269,38.4715 43.5051,38.7122C 43.1618,39.9358 42.6286,41.0191 41.9583,41.8856L 41.9583,46.0486C 44.1574,46.4884 45.9167,46.7083 48.5555,48.0278C 51.1944,49.3472 52.0741,50.5567 53.8333,52.316L 53.8333,58.5833L 22.1667,58.5833L 22.1666,52.316C 23.9259,50.5567 24.8055,49.3472 27.4444,48.0278C 30.0833,46.7083 31.8426,46.4884 34.0417,46.0486L 34.0417,41.8856C 33.3714,41.0191 32.8382,39.9358 32.4949,38.7121C 31.6731,38.4715 31.0729,37.7121 31.0729,36.8125C 31.0729,36.0773 31.4737,35.4358 32.0688,35.0945C 31.4028,29.5555 33.3819,26.9167 38,26.9167 Z M 25.8611,46.8403C 23.6735,47.9341 23.8824,47.7648 22.6094,49.0834L 12.6667,49.0833L 12.6667,42.816C 14.4259,41.0567 15.3056,39.8472 17.9444,38.5278C 20.5833,37.2083 22.3426,36.9884 24.5417,36.5486L 24.5417,32.3856C 23.8714,31.5191 23.3382,30.4359 22.9949,29.2122C 22.1731,28.9715 21.5729,28.2121 21.5729,27.3125C 21.5729,26.5773 21.9738,25.9358 22.5688,25.5945C 21.9028,20.0556 23.8819,17.4167 28.5,17.4167C 32.8315,17.4167 34.8414,20.9258 34.5246,25.7844C 31.6667,26.9167 30.0833,28.5 30.0896,33.1153C 29.4946,33.4566 29.0938,34.0982 29.0938,34.8333C 29.0938,35.7329 29.2981,36.8882 30.1199,37.1288C 30.4632,38.3525 30.9964,39.4358 31.6667,40.3023L 31.6667,44.8611C 29.4676,45.3009 28.5,45.5208 25.8611,46.8403 Z M 50.1389,46.8403C 47.5,45.5208 46.5324,45.3009 44.3333,44.8611L 44.3333,40.3023C 45.0036,39.4358 45.5368,38.3525 45.8801,37.1288C 46.7019,36.8882 46.9062,35.7329 46.9062,34.8333C 46.9062,34.0982 46.5054,33.4566 45.9104,33.1153C 45.9167,28.5 44.3333,26.9167 41.4754,25.7844C 41.1585,20.9257 43.1685,17.4167 47.5,17.4167C 52.118,17.4167 54.0972,20.0555 53.4312,25.5945C 54.0262,25.9358 54.4271,26.5773 54.4271,27.3125C 54.4271,28.2121 53.8269,28.9715 53.0051,29.2121C 52.6618,30.4358 52.1286,31.5191 51.4583,32.3856L 51.4583,36.5486C 53.6574,36.9884 55.4166,37.2083 58.0555,38.5278C 60.6944,39.8472 61.5741,41.0567 63.3333,42.816L 63.3333,49.0833L 53.3906,49.0833C 52.1176,47.7648 52.3265,47.9341 50.1389,46.8403 Z " />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Path=Name}" Value="Price Lists">
                        <Setter TargetName="itemPath" Property="Data" Value="F1 M 17.4167,17.4167L 58.5833,17.4167L 58.5833,55.4167L 17.4167,55.4167L 17.4167,17.4167 Z M 20.5833,20.5834L 20.5833,37.9999L 55.4166,37.9999L 55.4166,20.5834L 20.5833,20.5834 Z M 20.5833,52.25L 55.4166,52.25L 55.4166,49.0832L 20.5833,49.0832L 20.5833,52.25 Z M 55.4166,44.3332L 20.5833,44.3332L 20.5833,47.4999L 55.4166,47.4999L 55.4166,44.3332 Z M 55.4166,39.5832L 20.5833,39.5832L 20.5833,42.7499L 55.4166,42.7499L 55.4166,39.5832 Z M 27.0011,34.8333L 24.7844,34.8333L 24.7844,23.8978L 27.0011,23.8978L 27.0011,34.8333 Z M 30.0306,26.2622C 29.6626,26.2622 29.3613,26.1472 29.1266,25.917C 28.8918,25.6869 28.7744,25.404 28.7744,25.0685C 28.7744,24.7252 28.8918,24.4443 29.1266,24.2257C 29.3613,24.0071 29.6626,23.8978 30.0306,23.8978C 30.4031,23.8978 30.7056,24.0071 30.938,24.2257C 31.1704,24.4443 31.2867,24.7252 31.2867,25.0685C 31.2867,25.4179 31.1704,25.7042 30.938,25.9274C 30.7056,26.1506 30.4031,26.2622 30.0306,26.2622 Z M 31.1389,34.8333L 28.9222,34.8333L 28.9222,27.4445L 31.1389,27.4445L 31.1389,34.8333 Z M 32.4689,34.5817L 32.4689,32.6167L 33.6107,33.1732L 34.6855,33.3556L 35.66,33.2124C 35.897,33.117 36.0155,32.9723 36.0155,32.7783L 35.8539,32.4204L 35.4394,32.1699L 34.8853,31.9771L 34.3046,31.7831L 33.5149,31.4287L 32.9422,30.9877L 32.5901,30.4081L 32.4689,29.6288C 32.4689,29.2193 32.5609,28.8664 32.7448,28.5701C 32.9288,28.2738 33.1735,28.0317 33.4791,27.8439L 34.5297,27.4294L 35.7616,27.2967L 36.7752,27.3729L 37.7889,27.5945L 37.7889,29.3656L 36.8283,29.0331L 35.8216,28.9222L 35.3852,28.9557L 35.0227,29.0538L 34.7756,29.2201L 34.6855,29.451L 34.8195,29.795L 35.1693,30.0421L 35.6484,30.228L 36.1726,30.3954L 37.02,30.7383L 37.67,31.1747L 38.0867,31.7623L 38.2322,32.5636C 38.2322,32.9977 38.1356,33.3683 37.9424,33.6754C 37.7492,33.9825 37.4926,34.2326 37.1724,34.4258L 36.0652,34.8483L 34.7641,34.9811C 33.9374,34.9811 33.1724,34.848 32.4689,34.5817 Z M 43.8478,34.6856C 43.5184,34.8826 43.0227,34.9811 42.3608,34.9811C 40.7906,34.9811 40.0056,34.1429 40.0056,32.4666L 40.0056,29.07L 38.8233,29.07L 38.8233,27.4444L 40.0056,27.4444L 40.0056,25.8697L 42.2222,25.2278L 42.2222,27.4444L 43.8478,27.4444L 43.8478,29.07L 42.2222,29.07L 42.2222,32.0533C 42.2222,32.8229 42.5216,33.2078 43.1204,33.2078L 43.8478,33.06L 43.8478,34.6856 Z " />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Path=Name}" Value="Rules">
                        <Setter TargetName="itemPath" Property="Data" Value="F1 M 19,19L 28.5,19L 28.5,28.5L 19,28.5L 19,19 Z M 39.5833,18.9999L 42.7501,18.9998L 42.7502,23.7498L 44.3335,23.7498L 44.3334,18.9998L 47.5,18.9999L 47.5001,25.3332L 49.0834,25.3332L 49.0834,18.9999L 52.25,19L 52.2501,23.7499L 53.8334,23.7499L 53.8333,19L 57,19L 57,28.4999L 30.0833,28.5L 30.0833,19L 33.25,19L 33.25,23.7499L 34.8333,23.7499L 34.8333,19L 38,18.9999L 38.0001,25.3332L 39.5834,25.3332L 39.5833,18.9999 Z M 19.0001,47.5L 19,44.3333L 23.7499,44.3332L 23.7499,42.7498L 19,42.7499L 19.0001,39.5833L 25.3333,39.5833L 25.3333,37.9999L 19.0001,38L 19.0001,34.8334L 23.75,34.8333L 23.75,33.25L 19.0001,33.2501L 19.0001,30.0834L 28.5001,30.0833L 28.5001,57.0001L 19.0002,57.0001L 19.0001,53.8334L 23.7501,53.8334L 23.7501,52.25L 19.0001,52.2501L 19.0001,49.0834L 25.3334,49.0833L 25.3334,47.5L 19.0001,47.5 Z " />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Path=Name}" Value="Rollback">
                        <Setter TargetName="itemPath" Property="Data" Value="F1 M 18,42.5L 18,49L 27,57L 36,48.5L 36,42.5L 30,47.7903L 30,35.5C 30,29.701 34.701,25 40.5,25C 46.299,25 51,29.701 51,35.5C 51,41.1314 46.5668,45.7273 41,45.9883L 41,51.9926C 49.8814,51.7283 57,44.4454 57,35.5C 57,26.3873 49.6127,19 40.5,19C 31.3873,19 24,26.3873 24,35.5L 24,47.875L 18,42.5 Z " />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Path=Name}" Value="Processes">
                        <Setter TargetName="itemPath" Property="Data" Value="F1 M 32.6227,68.9728C 33.1208,70.2446 33.7077,71.4719 34.3757,72.6471C 35.567,72.7702 36.7761,72.8333 38,72.8333C 40.6447,72.8333 43.2205,72.5386 45.6965,71.9802C 42.2807,68.5449 40.1698,63.8107 40.1698,58.5835C 40.1698,48.0901 48.6764,39.5835 59.1698,39.5835C 64.2047,39.5835 68.7822,41.5419 72.182,44.7385C 72.6094,42.5584 72.8333,40.3053 72.8333,38C 72.8333,36.442 72.731,34.908 72.5328,33.4041C 70.4772,32.3109 68.2718,31.4621 65.9554,30.8963L 65.6219,22.7367C 63.5664,22.3692 61.4511,22.1741 59.2916,22.1671L 57.491,30.1322C 54.2845,30.3184 51.2204,31.0348 48.3848,32.1949L 43.318,25.7887C 41.3995,26.7177 39.5749,27.8102 37.8622,29.0479L 41.0883,36.5527C 38.6742,38.5364 36.5919,40.9091 34.9373,43.575L 27.0703,41.3697C 26.073,43.2256 25.2319,45.178 24.5646,47.2093L 31.5867,51.385C 30.9883,53.6844 30.6698,56.0968 30.6698,58.5835L 30.746,60.6839L 23.0854,63.5239C 23.3743,65.6539 23.8474,67.7255 24.4881,69.7219L 32.6227,68.9728 Z M 27.0669,37.1755L 34.9338,39.3807C 35.9312,37.5248 36.7723,35.5724 37.4395,33.5412L 30.4175,29.3654C 31.0159,27.066 31.3344,24.6537 31.3344,22.1669L 31.2581,20.0665L 38.9187,17.2265C 38.6299,15.0965 38.1568,13.0249 37.5161,11.0285L 29.3815,11.7776C 28.4787,9.47258 27.2844,7.31377 25.8439,5.34655C 22.7943,6.48232 19.9467,8.03307 17.3698,9.93015C 20.1557,13.2359 21.8344,17.5054 21.8344,22.1669C 21.8344,32.5019 13.5826,40.9096 3.30816,41.1611C 3.60321,44.4411 4.35293,47.59 5.49381,50.5444C 8.34489,50.2806 11.0742,49.5968 13.6194,48.5555L 18.6861,54.9617C 20.6046,54.0327 22.4293,52.9403 24.142,51.7025L 20.9158,44.1977C 23.3299,42.2141 25.4123,39.8414 27.0669,37.1755 Z " />
                    </DataTrigger>
                </DataTemplate.Triggers>
            </DataTemplate>

        </ResourceDictionary>
    </controls:MetroWindow.Resources>

    <controls:MetroWindow.IconTemplate>
        <DataTemplate>
            <Grid Width="{TemplateBinding Width}"
                  Height="{TemplateBinding Height}"
                  Margin="4"
                  Background="Transparent"
                  RenderOptions.BitmapScalingMode="HighQuality"
                  RenderOptions.EdgeMode="Aliased">
                <Image Source="/APLPX.UI.WPF;component/Resources/APL_logo_new.png" />
            </Grid>
        </DataTemplate>
    </controls:MetroWindow.IconTemplate>

    <controls:MetroWindow.RightWindowCommands>
        <controls:WindowCommands>
            <ComboBox x:Name="themePicker"
                      Grid.Column="3"
                      Width="100"
                      Height="1"
                      Margin="1"
                      HorizontalAlignment="Right"
                      VerticalAlignment="Center"
                      HorizontalContentAlignment="Center"
                      VerticalContentAlignment="Center"
                      Foreground="Black"
                      SelectionChanged="themePicker_SelectionChanged" />

            <Button Command="{Binding Path=LaunchWebPageCommand}"
                    CommandParameter="http://www.advancedpricinglogic.com/"
                    Content="PRICEXPERT.com"
                    ToolTip="PRICEXPERT.com web site" />

            <Button Content="About" ToolTip="About PRICEXPERT" />

            <!--  <Button Click="LaunchRibbonDemo" Content="Ribbon Demo (.NET 4.5)" />  -->
            <Button Content="Help" ToolTip="Help documentation for PRICEXPERT" />

            <Button Command="{Binding LogoutCommand}" ToolTip="Logout of PRICEXPERT">
                <Button.Content>
                    <TextBlock>
                        <Run Text="Logout - " />
                        <TextBlock Text="{Binding CurrentUser.Login}" />
                    </TextBlock>

                </Button.Content>
            </Button>
        </controls:WindowCommands>
    </controls:MetroWindow.RightWindowCommands>

    <controls:MetroWindow.Flyouts>
        <controls:FlyoutsControl>
            <controls:Flyout x:Name="MessageCenter"
                             ContextMenuClosing="MessageCenter_ContextMenuClosing"
                             Header="Message Center"
                             IsOpenChanged="MessageCenter_IsOpenChanged"
                             Position="Right"
                             Theme="Accent"
                             Unloaded="Flyout_Unloaded">
                <Grid Width="400" Margin="10">
                    <DockPanel>
                        <TextBlock DockPanel.Dock="Top"
                                   Foreground="{DynamicResource IdealForegroundColorBrush}"
                                   Text="" />
                        <GroupBox Margin="10" Header="Analytics">
                            <ListView Width="Auto"
                                      MinHeight="250"
                                      Margin="10,10,10,23"
                                      Background="{StaticResource HighlightBrush}"
                                      BorderThickness="0"
                                      FontSize="16"
                                      FontWeight="Bold"
                                      Foreground="White"
                                      Padding="0,0,0,6">
                                <ListViewItem Content="1 - My Analytics" Foreground="{StaticResource MenuItemDisabledBrush}" />
                                <ListViewItem BorderThickness="0"
                                              Content="2 - Identity"
                                              FontSize="16"
                                              Foreground="White" />
                                <ListViewItem Content="3 - Filters" Foreground="{StaticResource MenuItemDisabledBrush}" />
                                <ListViewItem Content="4 - Price Lists" Foreground="{StaticResource MenuItemDisabledBrush}" />
                                <ListViewItem Content="5 - Value Drivers" Foreground="{StaticResource MenuItemDisabledBrush}" />
                                <ListViewItem Content="6 - Results" Foreground="{StaticResource MenuItemDisabledBrush}" />

                            </ListView>
                        </GroupBox>
                    </DockPanel>
                </Grid>
            </controls:Flyout>
            <controls:Flyout x:Name="Properties"
                             ContextMenuClosing="MessageCenter_ContextMenuClosing"
                             Header="Dialog Sample"
                             IsOpenChanged="MessageCenter_IsOpenChanged"
                             Position="Right"
                             Theme="Accent"
                             Unloaded="Flyout_Unloaded">
                <Grid Width="400" Margin="10">
                    <DockPanel>
                        <TextBlock DockPanel.Dock="Top"
                                   Foreground="{DynamicResource IdealForegroundColorBrush}"
                                   Text="" />
                        <GroupBox Margin="10"
                                  VerticalAlignment="Stretch"
                                  Header="Pricing">
                            <StackPanel>

                                <TextBlock x:Name="AnalyticTitle"
                                           Margin="10 0 0 0"
                                           FontSize="30"
                                           Foreground="White"
                                           Text="Price Routine-XXX" />
                                <TextBlock Margin="10 0 0 0"
                                           FontSize="18"
                                           Foreground="White"
                                           Text="All OPGI Parts" />
                                <TextBlock Margin="10 0 0 0"
                                           FontSize="18"
                                           Foreground="White"
                                           Text="Status: Active" />


                                <ListView Width="Auto"
                                          MinHeight="250"
                                          Margin="10,10,10,23"
                                          Background="{StaticResource HighlightBrush}"
                                          BorderThickness="0"
                                          FontSize="16"
                                          FontWeight="Bold"
                                          Foreground="White"
                                          Padding="0,0,0,6">

                                    <ListViewItem Background="Transparent" Foreground="White">

                                        <StackPanel>
                                            <TextBlock Text="Filters Selected:" />
                                            <Separator />
                                            <ListBox Background="{StaticResource HighlightBrush}" Foreground="White">
                                                <ListBoxItem Background="{StaticResource HighlightBrush}" FontWeight="ExtraLight">Filter1</ListBoxItem>
                                                <ListBoxItem Background="{StaticResource HighlightBrush}" FontWeight="ExtraLight">Filter2</ListBoxItem>
                                                <ListBoxItem Background="{StaticResource HighlightBrush}" FontWeight="ExtraLight">Filter3</ListBoxItem>
                                                <ListBoxItem Background="{StaticResource HighlightBrush}" FontWeight="ExtraLight">Filter4</ListBoxItem>
                                                <ListBoxItem Background="{StaticResource HighlightBrush}" FontWeight="ExtraLight">Filter5</ListBoxItem>
                                            </ListBox>
                                        </StackPanel>

                                    </ListViewItem>
                                    <ListViewItem Background="Transparent" Foreground="White">

                                        <StackPanel>
                                            <TextBlock Text="Included Price Lists:" />
                                            <Separator />
                                            <ListBox Background="{StaticResource HighlightBrush}" Foreground="White">
                                                <ListBoxItem Background="{StaticResource HighlightBrush}" FontWeight="ExtraLight">Price List 1</ListBoxItem>
                                                <ListBoxItem Background="{StaticResource HighlightBrush}" FontWeight="ExtraLight">Price List 2</ListBoxItem>
                                                <ListBoxItem Background="{StaticResource HighlightBrush}" FontWeight="ExtraLight">Price List 3</ListBoxItem>
                                                <ListBoxItem Background="{StaticResource HighlightBrush}" FontWeight="ExtraLight">Price List 4</ListBoxItem>
                                                <ListBoxItem Background="{StaticResource HighlightBrush}" FontWeight="ExtraLight">Price List 5</ListBoxItem>
                                            </ListBox>
                                        </StackPanel>

                                    </ListViewItem>

                                    <ListViewItem Foreground="{StaticResource MenuItemDisabledBrush}" />

                                    <StackPanel>
                                        <TextBlock Text="Included Value Drivers:" />
                                        <Separator />
                                        <ListBox Background="{StaticResource HighlightBrush}" Foreground="White">
                                            <ListBoxItem Background="{StaticResource HighlightBrush}" FontWeight="ExtraLight">Value Driver 1</ListBoxItem>
                                            <ListBoxItem Background="{StaticResource HighlightBrush}" FontWeight="ExtraLight">Value Driver 2</ListBoxItem>
                                            <ListBoxItem Background="{StaticResource HighlightBrush}" FontWeight="ExtraLight">Value Driver 3</ListBoxItem>
                                            <ListBoxItem Background="{StaticResource HighlightBrush}" FontWeight="ExtraLight">Value Driver 4</ListBoxItem>
                                            <ListBoxItem Background="{StaticResource HighlightBrush}" FontWeight="ExtraLight">Value Driver 5</ListBoxItem>
                                        </ListBox>
                                    </StackPanel>


                                </ListView>
                                <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">

                                    <Button Width="50"
                                            Height="50"
                                            Margin="0, 10, 0, 0"
                                            Style="{DynamicResource MetroCircleButtonStyle}">

                                        <Canvas xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                                                xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                                                x:Name="appbar_thumbs_up"
                                                Width="40"
                                                Height="40"
                                                Clip="F1 M 0,0L 76,0L 76,76L 0,76L 0,0">
                                            <!--  <Path Canvas.Left="10" Canvas.Top="10" Width="20" Height="20" Stretch="Fill" Fill="White" Data="F1 M 36.8125,14.4232C 36.8125,20.7565 34.0416,26.694 34.0416,25.1107C 34.0416,23.5274 30.875,29.8607 29.2916,33.0274C 27.7083,36.194 26.125,40.5482 26.125,40.5482L 19.7917,40.1524C 19.7917,40.1524 18.2083,54.0065 21.375,55.5899C 24.5417,57.1732 27.8391,54.9558 30.875,56.7774C 38.7916,61.5274 51.4583,58.3607 49.875,55.194C 49.875,55.194 56.2083,52.0274 54.625,50.444C 54.625,50.444 56.2083,48.069 54.2292,45.694C 56.2083,43.319 55.4167,40.944 54.2292,39.3607C 55.4167,36.9857 56.2083,34.6107 51.4583,33.0274C 48.4542,32.026 40.375,35.7982 40.375,31.444C 40.375,29.8607 43.5416,25.1107 43.5416,21.944C 43.5416,15.6107 36.8125,14.4232 36.8125,14.4232 Z "/>  -->
                                            <Path Canvas.Left="10"
                                                  Canvas.Top="10"
                                                  Width="20"
                                                  Height="20"
                                                  Data="F1 M 23.7501,33.25L 34.8334,44.3333L 52.2499,22.1668L 56.9999,26.9168L 34.8334,53.8333L 19.0001,38L 23.7501,33.25 Z "
                                                  Fill="White"
                                                  Stretch="Fill" />
                                        </Canvas>
                                    </Button>
                                    <Button Width="50"
                                            Height="50"
                                            Margin="0, 10, 0, 0"
                                            Style="{DynamicResource MetroCircleButtonStyle}">

                                        <Canvas xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                                                xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                                                Width="40"
                                                Height="40"
                                                Clip="F1 M 0,0L 76,0L 76,76L 0,76L 0,0">
                                            <Path Canvas.Left="10"
                                                  Canvas.Top="10"
                                                  Width="20"
                                                  Height="20"
                                                  Data="F1 M 17,19L 20,19L 20,54L 59,54L 59,57L 17,57L 17,19 Z M 22,52L 22,47L 31.6667,36.4167L 45.9167,42.75L 53.1866,30.0277L 47.9986,31.5153L 45.6038,28.9077L 57.7798,25.4163L 61.2712,37.5923L 57.7908,36.9432L 56.1901,31.3612L 47.5,47.5L 32.4167,40.6667L 22,52 Z "
                                                  Fill="White"
                                                  Stretch="Fill" />
                                        </Canvas>
                                    </Button>
                                    <Button Width="50"
                                            Height="50"
                                            Margin="0, 10, 0, 0"
                                            Style="{DynamicResource MetroCircleButtonStyle}">

                                        <Canvas xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                                                xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                                                Width="40"
                                                Height="40"
                                                Clip="F1 M 0,0L 76,0L 76,76L 0,76L 0,0">
                                            <Path Canvas.Left="10"
                                                  Canvas.Top="10"
                                                  Width="20"
                                                  Height="20"
                                                  Data="F1 M 35,51L 51,51L 43,43L 49.25,43L 60.25,53.5L 50.25,64L 43,64L 51,56L 35,56L 35,51 Z M 20,17L 43.25,17L 56,29.75L 56,47.75L 52,43.75L 52,34L 39,34L 39,21L 24,21L 24,55L 33.75,55L 34.75,59L 20,59L 20,17 Z M 43,22.25L 43,30L 50.75,30L 43,22.25 Z "
                                                  Fill="White"
                                                  Stretch="Fill" />
                                        </Canvas>
                                    </Button>
                                </StackPanel>
                            </StackPanel>
                        </GroupBox>

                    </DockPanel>
                </Grid>
            </controls:Flyout>
            <controls:Flyout x:Name="Folders"
                             ContextMenuClosing="MessageCenter_ContextMenuClosing"
                             Header="Add Folders:"
                             IsOpenChanged="MessageCenter_IsOpenChanged"
                             Position="Right"
                             Theme="Accent"
                             Unloaded="Flyout_Unloaded">
                <Grid Width="400" Margin="10">
                    <DockPanel>
                        <TextBlock DockPanel.Dock="Top"
                                   Foreground="{DynamicResource IdealForegroundColorBrush}"
                                   Text="" />
                        <GroupBox Margin="10"
                                  VerticalAlignment="Stretch"
                                  Header="Pricing">
                            <StackPanel>

                                <TextBlock x:Name="FolderTitle"
                                           Margin="10 0 0 0"
                                           FontSize="30"
                                           Foreground="White"
                                           Text="Select Folders" />
                                <TextBlock Margin="10 0 0 0"
                                           FontSize="18"
                                           Foreground="White"
                                           Text="All OPGI Parts" />
                                <TextBlock Margin="10 0 0 0"
                                           FontSize="18"
                                           Foreground="White"
                                           Text="Status: Active" />


                                <ListView Width="Auto"
                                          MinHeight="250"
                                          Margin="10,10,10,23"
                                          Background="{StaticResource HighlightBrush}"
                                          BorderThickness="0"
                                          FontSize="16"
                                          FontWeight="Bold"
                                          Foreground="White"
                                          Padding="0,0,0,6">

                                    <ListViewItem Background="Transparent" Foreground="White">

                                        <StackPanel>
                                            <TextBlock Text="Selected Analytic Folders:" />
                                            <Separator />
                                            <ListBox Background="{StaticResource HighlightBrush}"
                                                     Foreground="White"
                                                     SelectionMode="Multiple">
                                                <ListBoxItem Background="{StaticResource HighlightBrush}" FontWeight="ExtraLight">Folder 1</ListBoxItem>
                                                <ListBoxItem Background="{StaticResource HighlightBrush}" FontWeight="ExtraLight">Folder 2</ListBoxItem>
                                                <ListBoxItem Background="{StaticResource HighlightBrush}" FontWeight="ExtraLight">Folder 3</ListBoxItem>
                                                <ListBoxItem Background="{StaticResource HighlightBrush}" FontWeight="ExtraLight">Folder 4</ListBoxItem>
                                                <ListBoxItem Background="{StaticResource HighlightBrush}" FontWeight="ExtraLight">Folder 5</ListBoxItem>
                                            </ListBox>
                                        </StackPanel>

                                    </ListViewItem>
                                    <ListViewItem Background="Transparent" Foreground="White">

                                        <StackPanel>
                                            <TextBlock Text="Included Pricing Folders:" />
                                            <Separator />
                                            <ListBox Background="{StaticResource HighlightBrush}" Foreground="White">
                                                <ListBoxItem Background="{StaticResource HighlightBrush}" FontWeight="ExtraLight">Folder 1</ListBoxItem>
                                                <ListBoxItem Background="{StaticResource HighlightBrush}" FontWeight="ExtraLight">Folder 2</ListBoxItem>
                                                <ListBoxItem Background="{StaticResource HighlightBrush}" FontWeight="ExtraLight">Folder 3</ListBoxItem>
                                                <ListBoxItem Background="{StaticResource HighlightBrush}" FontWeight="ExtraLight">Folder 4</ListBoxItem>
                                                <ListBoxItem Background="{StaticResource HighlightBrush}" FontWeight="ExtraLight">Folder 5</ListBoxItem>
                                            </ListBox>
                                        </StackPanel>

                                    </ListViewItem>

                                    <ListViewItem Foreground="{StaticResource MenuItemDisabledBrush}" />

                                    <StackPanel>
                                        <TextBlock Text="Included Value Drivers:" />
                                        <Separator />
                                        <ListBox Background="{StaticResource HighlightBrush}" Foreground="White">
                                            <ListBoxItem Background="{StaticResource HighlightBrush}" FontWeight="ExtraLight">Value Driver 1</ListBoxItem>
                                            <ListBoxItem Background="{StaticResource HighlightBrush}" FontWeight="ExtraLight">Value Driver 2</ListBoxItem>
                                            <ListBoxItem Background="{StaticResource HighlightBrush}" FontWeight="ExtraLight">Value Driver 3</ListBoxItem>
                                            <ListBoxItem Background="{StaticResource HighlightBrush}" FontWeight="ExtraLight">Value Driver 4</ListBoxItem>
                                            <ListBoxItem Background="{StaticResource HighlightBrush}" FontWeight="ExtraLight">Value Driver 5</ListBoxItem>
                                        </ListBox>
                                    </StackPanel>


                                </ListView>
                                <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">

                                    <Button Width="50"
                                            Height="50"
                                            Margin="0, 10, 0, 0"
                                            Style="{DynamicResource MetroCircleButtonStyle}">

                                        <Canvas xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                                                xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                                                x:Name="appbar_save_folders"
                                                Width="40"
                                                Height="40"
                                                Clip="F1 M 0,0L 76,0L 76,76L 0,76L 0,0">
                                            <!--  <Path Canvas.Left="10" Canvas.Top="10" Width="20" Height="20" Stretch="Fill" Fill="White" Data="F1 M 36.8125,14.4232C 36.8125,20.7565 34.0416,26.694 34.0416,25.1107C 34.0416,23.5274 30.875,29.8607 29.2916,33.0274C 27.7083,36.194 26.125,40.5482 26.125,40.5482L 19.7917,40.1524C 19.7917,40.1524 18.2083,54.0065 21.375,55.5899C 24.5417,57.1732 27.8391,54.9558 30.875,56.7774C 38.7916,61.5274 51.4583,58.3607 49.875,55.194C 49.875,55.194 56.2083,52.0274 54.625,50.444C 54.625,50.444 56.2083,48.069 54.2292,45.694C 56.2083,43.319 55.4167,40.944 54.2292,39.3607C 55.4167,36.9857 56.2083,34.6107 51.4583,33.0274C 48.4542,32.026 40.375,35.7982 40.375,31.444C 40.375,29.8607 43.5416,25.1107 43.5416,21.944C 43.5416,15.6107 36.8125,14.4232 36.8125,14.4232 Z "/>  -->
                                            <Path Canvas.Left="10"
                                                  Canvas.Top="10"
                                                  Width="20"
                                                  Height="20"
                                                  Data="F1 M 23.7501,33.25L 34.8334,44.3333L 52.2499,22.1668L 56.9999,26.9168L 34.8334,53.8333L 19.0001,38L 23.7501,33.25 Z "
                                                  Fill="White"
                                                  Stretch="Fill" />
                                        </Canvas>
                                    </Button>

                                </StackPanel>
                            </StackPanel>
                        </GroupBox>

                    </DockPanel>
                </Grid>
            </controls:Flyout>

        </controls:FlyoutsControl>
    </controls:MetroWindow.Flyouts>


    <Grid x:Name="layoutRoot"
          MinWidth="1080"
          MinHeight="530"
          Background="DimGray"
          IsEnabled="{Binding Path=IsActionInProgress,
                              Converter={StaticResource InverseBooleanConverter}}">

        <Grid.RowDefinitions>
            <RowDefinition x:Name="rowModules" Height="Auto" />
            <RowDefinition x:Name="rowDetailContent" Height="*" />
            <RowDefinition x:Name="rowStatusBar" Height="Auto" />
        </Grid.RowDefinitions>

        <StackPanel x:Name="ModuleListPanel"
                    Grid.Row="0"
                    Orientation="Horizontal">
            <ListBox x:Name="ModuleListBox"
                     Grid.Row="0"
                     Margin="5,5,0,0"
                     ItemTemplate="{StaticResource moduleItemTemplate}"
                     ItemsSource="{Binding Source={StaticResource cvsModules}}"
                     SelectedItem="{Binding Path=SelectedModule}">
                <ListBox.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Orientation="Horizontal" />
                    </ItemsPanelTemplate>
                </ListBox.ItemsPanel>
            </ListBox>

            <CheckBox x:Name="chkShowFeatureSelector"
                      IsChecked="{Binding Path=IsFeatureSelectorAvailable}"
                      ToolTip="Temporary-For demo only" />
        </StackPanel>

        <Grid x:Name="gridMainContent"
              Grid.Row="1"
              Margin="5,2">

            <Grid.ColumnDefinitions>
                <ColumnDefinition x:Name="colFeatureSelector" Width="Auto" />
                <ColumnDefinition x:Name="colSteps" Width="Auto" />
                <ColumnDefinition x:Name="colDetailContent" Width="*" />
                <ColumnDefinition x:Name="colActions" Width="Auto" />
                <ColumnDefinition x:Name="colCommands" Width="Auto" />
            </Grid.ColumnDefinitions>

            <Grid.RowDefinitions>
                <RowDefinition x:Name="rowContextHeader" Height="Auto" />
                <RowDefinition x:Name="rowDetailView" Height="*" />
            </Grid.RowDefinitions>

            <ListBox x:Name="FeatureListBox"
                     Grid.Row="0"
                     Grid.RowSpan="2"
                     Grid.Column="0"
                     Margin="0,27,0,0"
                     ItemTemplate="{StaticResource featureItemTemplate}"
                     ItemsSource="{Binding Source={StaticResource cvsFeatures}}"
                     SelectedItem="{Binding Path=SelectedModule.SelectedFeature}"
                     Visibility="{Binding Path=IsFeatureSelectorAvailable,
                                          Converter={StaticResource BooleanToVisibilityConverter}}" />

            <StackPanel x:Name="ContextHeaderPanel"
                        Grid.Row="0"
                        Grid.Column="1"
                        Grid.ColumnSpan="2"
                        Orientation="Horizontal"
                        Visibility="{Binding Path=IsModuleSelected,
                                             Converter={StaticResource BooleanToVisibilityConverter}}">

                <TextBlock x:Name="txtSelectedModule"
                           Style="{StaticResource MainWindowHeaderTextStyle}"
                           Text="{Binding Path=SelectedModule.Name,
                                          StringFormat={}Module: {0}}" />

                <TextBlock x:Name="txtSelectedFeature"
                           Margin="15,5"
                           Text="{Binding Path=SelectedFeature.Name,
                                          StringFormat={}Feature: {0}}">
                    <TextBlock.Style>
                        <Style BasedOn="{StaticResource MainWindowHeaderTextStyle}" TargetType="TextBlock">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Path=SelectedFeature}" Value="{x:Null}">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>

                    </TextBlock.Style>
                </TextBlock>
                <TextBlock x:Name="txtSelectedEntity"
                           Margin="15,5"
                           Text="{Binding Path=SelectedEntity.Identity.Name,
                                          StringFormat={}Selected: {0}}">
                    <TextBlock.Style>
                        <Style BasedOn="{StaticResource MainWindowHeaderTextStyle}" TargetType="TextBlock">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Path=SelectedEntity}" Value="{x:Null}">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
            </StackPanel>

            <ScrollViewer x:Name="DetailContentScrollViewer"
                          Grid.Row="1"
                          Grid.Column="2"
                          Width="Auto"
                          Height="Auto"
                          Background="{DynamicResource MainWindowBackground}"
                          ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                          ScrollViewer.VerticalScrollBarVisibility="Disabled"
                          d:IsEffectDisabled="True">
                <ScrollViewer.Effect>
                    <DropShadowEffect BlurRadius="10" Opacity="0" />
                </ScrollViewer.Effect>

                <ContentControl x:Name="ContentMain"
                                Background="DarkGray"
                                Content="{Binding SelectedFeatureViewModel}" />
            </ScrollViewer>

            <Grid x:Name="ActionGrid"
                  Grid.Row="1"
                  Grid.Column="3"
                  MinWidth="200"
                  Background="Gray"
                  Visibility="{Binding Path=IsEntitySelected,
                                       Converter={StaticResource BooleanToVisibilityConverter}}">

                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <Grid.Resources>
                    <CollectionViewSource x:Key="cvsActions" Source="{Binding Path=SelectedFeature.SelectedStep.Actions}">
                        <CollectionViewSource.SortDescriptions>
                            <scm:SortDescription Direction="Ascending" PropertyName="Sort" />
                        </CollectionViewSource.SortDescriptions>
                    </CollectionViewSource>
                </Grid.Resources>

                <TextBlock Grid.Row="0"
                           Margin="10,0"
                           FontSize="18"
                           Foreground="{StaticResource Foreground}"
                           Text="Actions" />

                <ItemsControl x:Name="ActionsListBox"
                              Grid.Row="1"
                              Margin="0"
                              BorderThickness="1"
                              ItemsSource="{Binding Source={StaticResource cvsActions}}"
                              Padding="5">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <MenuItem Command="{Binding ElementName=layoutRoot,
                                                        Path=DataContext.ActionCommand}"
                                      CommandParameter="{Binding}"
                                      FontFamily="SegoeUI"
                                      FontSize="16"
                                      Foreground="Black"
                                      Header="{Binding Path=Name}"
                                      Style="{x:Null}"
                                      ToolTip="{Binding Path=Title}" />
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

            </Grid>

            <StackPanel x:Name="StepsPanel"
                        Grid.Row="2"
                        Grid.Column="1"
                        Background="Gray"
                        Orientation="Vertical"
                        Visibility="{Binding Path=IsStepSelectorAvailable,
                                             Converter={StaticResource BooleanToVisibilityConverter}}">

                <StackPanel.Resources>
                    <CollectionViewSource x:Key="cvsSteps" Source="{Binding Path=SelectedFeature.Steps}">
                        <CollectionViewSource.SortDescriptions>
                            <scm:SortDescription Direction="Ascending" PropertyName="Sort" />
                        </CollectionViewSource.SortDescriptions>
                    </CollectionViewSource>
                </StackPanel.Resources>

                <!--
                    <StackPanel.Background>
                    <ImageBrush ImageSource="/APLPX.UI.WPF;component/Resources/bodyBackground.jpg" Stretch="UniformToFill" />
                    </StackPanel.Background>
                -->

                <ListBox x:Name="StepsListBox"
                         Grid.Column="1"
                         Margin="5"
                         ItemsSource="{Binding Source={StaticResource cvsSteps}}"
                         SelectedItem="{Binding Path=SelectedFeature.SelectedStep}">

                    <ListBox.Resources>
                        <SolidColorBrush x:Key="{x:Static SystemColors.InactiveSelectionHighlightBrushKey}" Color="DarkGray" />
                    </ListBox.Resources>

                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Style="{x:Null}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock x:Name="txtValue"
                                               Grid.Column="0"
                                               Width="150"
                                               Margin="2"
                                               FontFamily="SegoeUI"
                                               Style="{StaticResource AnalyticStepTextStyle}"
                                               Text="{Binding Path=Name}"
                                               ToolTip="{Binding Path=Title}" />
                                    <Image x:Name="checkMarkImage"
                                           Grid.Column="1"
                                           HorizontalAlignment="Right"
                                           Source="/APLPX.UI.WPF;component/Resources/completedStepCheck.png"
                                           Visibility="{Binding Path=IsCompleted,
                                                                Converter={StaticResource BooleanToVisibilityConverter}}" />
                                </Grid>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                    <ListBox.ItemContainerStyle>
                        <Style BasedOn="{StaticResource mainWindowItemContainerStyle}" TargetType="ListBoxItem" />
                    </ListBox.ItemContainerStyle>
                </ListBox>
            </StackPanel>

            <StackPanel x:Name="CommandBar"
                        Grid.Row="2"
                        Grid.Column="4"
                        Width="Auto"
                        Margin="2,0">

                <Button x:Name="MessageCenterButton"
                        Click="MessageCenterButton_Click"
                        Style="{StaticResource commandButtonStyle}">
                    <Canvas x:Name="appbar_inbox" Style="{StaticResource commandCanvasStyle}">
                        <Path Data="F1 M 37.2083,42.75L 28.5,31.6667L 33.25,31.6667L 33.25,19L 42.75,19L 42.75,31.6667L 47.5,31.6667L 38.7917,42.75L 37.2083,42.75 Z M 19,38L 23.75,26.9167L 29.6875,26.9167L 29.6875,30.0833L 26.125,30.0833L 22.9583,38L 30.875,38C 30.875,41.935 34.065,45.125 38,45.125C 41.935,45.125 45.125,41.935 45.125,38L 53.0417,38L 49.875,30.0833L 46.3125,30.0833L 46.3125,26.9167L 52.25,26.9167L 57,38L 57,53.8333L 19,53.8333L 19,38 Z " Style="{StaticResource commandPathStyle}" />
                    </Canvas>
                </Button>
                <Button x:Name="PropertiesButton"
                        Click="PropertiesButton_Click"
                        Style="{StaticResource commandButtonStyle}">
                    <Canvas x:Name="appbar_list" Style="{StaticResource commandCanvasStyle}">
                        <Path Data="F1 M 19,23L 27,23L 27,31L 19,31L 19,23 Z M 19,34L 27,34L 27,42L 19,42L 19,34 Z M 31,23L 57,23L 57,31L 31,31L 31,23 Z M 19,45L 27,45L 27,53L 19,53L 19,45 Z M 31,34L 57,34L 57,42L 31,42L 31,34 Z M 31,45L 57,45L 57,53L 31,53L 31,45 Z " Style="{StaticResource commandPathStyle}" />
                    </Canvas>
                </Button>
            </StackPanel>

        </Grid>

        <StatusBar x:Name="statusBarMain"
                   Grid.Row="2"
                   Margin="5"
                   Background="Transparent">
            <StatusBarItem>
                <TextBlock x:Name="txtCurrentStatus"
                           Width="125"
                           Margin="5,0"
                           Foreground="Black"
                           Text="{Binding Path=CurrentStatusText}"
                           TextTrimming="CharacterEllipsis" />
            </StatusBarItem>
            <StatusBarItem>
                <ProgressBar x:Name="progressBarMain"
                             Width="250"
                             Height="20"
                             Background="Transparent"
                             BorderBrush="Transparent"
                             IsIndeterminate="{Binding Path=IsActionInProgress}">
                    <ProgressBar.Triggers>
                        <EventTrigger RoutedEvent="ProgressBar.Loaded">
                            <BeginStoryboard>
                                <Storyboard>
                                    <DoubleAnimation Duration="0:0:2"
                                                     FillBehavior="Stop"
                                                     From="0"
                                                     Storyboard.TargetName="progressBarMain"
                                                     Storyboard.TargetProperty="Value"
                                                     To="100" />
                                </Storyboard>
                            </BeginStoryboard>
                        </EventTrigger>
                    </ProgressBar.Triggers>
                </ProgressBar>
            </StatusBarItem>
        </StatusBar>

    </Grid>

</controls:MetroWindow>
